% Arquivo LaTeX de exemplo de dissertação/tese a ser apresentados ?CPG do IME-USP
% 
% Vers? 5: Sex Mar  9 18:05:40 BRT 2012
%
% Cria?o: Jes?s P. Mena-Chalco
% Revis?: Fabio Kon e Paulo Feofiloff
%  
% Obs: Leia previamente o texto do arquivo README.txt

\documentclass[12pt,oneside,a4paper]{book} % utilizando extbook para atender ao modelo do IPT

\usepackage{sectsty}
\allsectionsfont{\Large\bfseries}

% ---------------------------------------------------------------------------- %
% Pacotes 
\usepackage{fontspec}
\setmainfont{Arial} % funciona com windows/mac
%\usepackage{polyglossia}
%\setdefaultlanguage{brazil}
\usepackage[alf]{abntex2cite}
\usepackage[brazil]{babel}
\usepackage{titlesec} % cabe?lhos dos t?ulos: menores e compactos
%\usepackage[fixlanguage]{babelbib}

\usepackage[xetex]{graphicx}           % usamos arquivos pdf/png como figuras
\usepackage{setspace}                   % espa?mento flex?el
\usepackage{indentfirst}                % indenta?o do primeiro par?rafo
\usepackage{makeidx}                    % ?dice remissivo

\usepackage[nottoc,notlof,notlot]{tocbibind}          % acrescentamos a bibliografia/indice/conteudo no Table of Contents
\usepackage{courier}                    % usa o Adobe Courier no lugar de Computer Modern Typewriter
\usepackage{type1cm}                    % fontes realmente escal?eis
\usepackage{listings}                   % para formatar c?igo-fonte (ex. em Java)
\usepackage{titletoc}
\usepackage[font=small,format=plain,labelfont=bf,up]{caption}
\usepackage[usenames,svgnames,dvipsnames, table]{xcolor}
\usepackage[a4paper,top=2.54cm,bottom=2.0cm,left=2.0cm,right=2.54cm]{geometry} % margens
%\usepackage[pdftex,plainpages=false,pdfpagelabels,pagebackref,colorlinks=true,citecolor=black,linkcolor=black,urlcolor=black,filecolor=black,bookmarksopen=true]{hyperref} % links em preto

\usepackage[titles]{tocloft}

\setlength{\cftpartindent}{0em}
\setlength{\cftchapindent}{0em}
\setlength{\cftsecindent}{0em}
\setlength{\cftsubsecindent}{0em}
\setlength{\cftsubsubsecindent}{0em}

\newlength{\mylen}

\renewcommand{\cftfigpresnum}{\figurename\enspace}
\renewcommand{\cftfigaftersnum}{\enspace-}
\settowidth{\mylen}{\cftfigpresnum\cftfigaftersnum}
\addtolength{\cftfignumwidth}{\mylen}

\renewcommand{\cfttabpresnum}{\tablename\enspace}
\renewcommand{\cfttabaftersnum}{\enspace-}
\settowidth{\mylen}{\cfttabpresnum\cfttabaftersnum}
\addtolength{\cfttabnumwidth}{\mylen}

%\usepackage[breaklinks,plainpages=false,pdfpagelabels,bookmarksopen=true]{hyperref} % links coloridos
\def\UrlBreaks{\do\/\do-}
%\usepackage[all]{hypcap}                    % soluciona o problema com o hyperref e capitulos
%\usepackage[round,sort]{natbib} % cita?o bibliogr?ica textual(plainnat-ime.bst)
\fontsize{60}{62}\usefont{OT1}{cmr}{m}{n}{\selectfont}


% subcaption
\usepackage{subcaption}

% todo-notes
\usepackage[colorinlistoftodos]{todonotes}


\usepackage[acronym, toc, xindy]{glossaries}
\usepackage{amssymb}
\usepackage{multirow}
\usepackage{bm}
\usepackage{stmaryrd}

\usepackage{longtable}
\usepackage[useregional]{datetime2}



\usepackage{array}
\newcolumntype{P}[1]{>{\raggedleft\arraybackslash}p{#1}}

\makeatletter
\newcommand{\emptypage}[1]{%
  \cleardoublepage
  \begingroup
  \let\ps@plain\ps@empty
  \pagestyle{empty}
  #1
  \cleardoublepage
  \endgroup
}
\makeatletter

\makenoidxglossaries
\input{util/glossary.tex}

% ---------------------------------------------------------------------------- %
% Cabe?lhos similares ao TAOCP de Donald E. Knuth
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{}}{}}
\renewcommand{\sectionmark}[1]{\markright{\MakeUppercase{}}{}}
\renewcommand{\headrulewidth}{0pt}

% ---------------------------------------------------------------------------- %
\graphicspath{{./figuras/}}             % caminho das figuras (recomend?el)
\frenchspacing                          % arruma o espa?: id est (i.e.) e exempli gratia (e.g.) 
\urlstyle{same}                         % URL com o mesmo estilo do texto e n? mono-spaced
\makeindex                              % para o ?dice remissivo
\raggedbottom                           % para n? permitir espa?s extra no texto
\fontsize{60}{62}\usefont{OT1}{cmr}{m}{n}{\selectfont}
\cleardoublepage
\normalsize

% ---------------------------------------------------------------------------- %
% Op?es de listing usados para o c?igo fonte
% Ref: http://en.wikibooks.org/wiki/LaTeX/Packages/Listings
\lstset{ %
language=Java,                  % choose the language of the code
basicstyle=\footnotesize,       % the size of the fonts that are used for the code
numbers=left,                   % where to put the line-numbers
numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
stepnumber=1,                   % the step between two line-numbers. If it's 1 each line will be numbered
numbersep=5pt,                  % how far the line-numbers are from the code
showspaces=false,               % show spaces adding particular underscores
showstringspaces=false,         % underline spaces within strings
showtabs=false,                 % show tabs within strings adding particular underscores
frame=single,	                % adds a frame around the code
framerule=0.6pt,
tabsize=2,	                    % sets default tabsize to 2 spaces
captionpos=b,                   % sets the caption-position to bottom
breaklines=true,                % sets automatic line breaking
breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
escapeinside={\%*}{*)},         % if you want to add a comment within your code
backgroundcolor=\color[rgb]{1.0,1.0,1.0}, % choose the background color.
rulecolor=\color[rgb]{0.8,0.8,0.8},
extendedchars=true,
xleftmargin=10pt,
xrightmargin=10pt,
framexleftmargin=10pt,
framexrightmargin=10pt
}

\usepackage{color}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{ %
  language=python,
  backgroundcolor=\color{white},   % choose the background color
  basicstyle=\footnotesize,        % size of fonts used for the code
  breaklines=true,                 % automatic line breaking only at whitespace
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  keywordstyle=\color{blue},       % keyword style
  stringstyle=\color{mymauve},     % string literal style
  numbers=none,
}
\captionsetup{%
   figurewithin=none,
   tablewithin=none,
   labelsep=endash
}
\captionsetup[figure]{labelfont={bf},labelformat={default},name={Figura}}
\newcommand{\source}[1]{\caption*{\textbf{Fonte -} {#1}} }
\renewcommand{\lstlistingname}{Trecho de código-fonte}% Listing -> Algorithm
\renewcommand{\lstlistlistingname}{Lista de trechos de códigos-fontes}% List of Listings -> List of Algorithms

% ---------------------------------------------------------------------------- %


\usepackage{minted}
\usepackage[most, minted]{tcolorbox}


\newtcblisting{mypython}[1]{%
listing engine=minted,
minted style=colorful,
minted language=python,
minted options= {escapeinside=||},
listing only,
title={#1}, fonttitle=\bfseries,
enlarge top by=1cm,%     equivalent to mdframed 'skipabove'
enlarge bottom by=1cm,%  equivalent to mdframed 'skipbelow'
  }
  
\newtcblisting{mypython-linenumber}[1]{%
listing engine=minted,
minted style=colorful,
minted language=python,
minted options= {xleftmargin=10pt, escapeinside=||, linenos, breaklines},
listing only,
title={#1}, fonttitle=\bfseries,
enlarge top by=1cm,%     equivalent to mdframed 'skipabove'
enlarge bottom by=1cm,%  equivalent to mdframed 'skipbelow'
breakable=unlimited
  }
  

  
\newtcblisting{mypythonembedding}[1]{%
listing engine=minted,
colback=green!5!white,colframe=green!75!black,
minted language=python,
listing only,
fonttitle=\bfseries,
enlarge top by=1cm,%     equivalent to mdframed 'skipabove'
enlarge bottom by=1cm,%  equivalent to mdframed 'skipbelow'
minted options= {escapeinside=||},
title={#1}
}

\newtcblisting{mypythongreen}[1]{%
listing engine=minted,
colback=green!5!white,colframe=green!75!black,
minted language=python,
listing only,
fonttitle=\bfseries,
%enlarge top by=1cm,%     equivalent to mdframed 'skipabove'
%enlarge bottom by=1cm,%  equivalent to mdframed 'skipbelow'
minted options= {escapeinside=||},
title={#1}
}

\newtcblisting{mypythonred}[1]{%
listing engine=minted,
colback=red!5!white,colframe=red!75!black,
minted language=python,
listing only,
fonttitle=\bfseries,
%enlarge top by=1cm,%     equivalent to mdframed 'skipabove'
%enlarge bottom by=1cm,%  equivalent to mdframed 'skipbelow'
minted options= {escapeinside=||},
title={#1}
}

\newtcblisting{mypython-without-margin}[1]{%
listing engine=minted,
minted style=colorful,
minted language=python,
minted options= {escapeinside=||},
listing only,
title={#1}, fonttitle=\bfseries
  }
  


% alterando seçoes para manter o padrao ABNT  
\titleformat{\chapter}[block]
{\normalfont\normalsize\bfseries}{\thechapter}{12pt}{\MakeUppercase}
\titleformat{\section}[block]
{\normalfont\normalsize\mdseries}{\thesection}{12pt}{}
\titleformat{\subsection}[block]
{\normalfont\normalsize\mdseries}{\thesubsection}{12pt}{}
\titleformat{\subsubsection}[block]
{\normalfont\normalsize\mdseries}{\thesubsubsection}{12pt}{}


% Corpo do texto
\begin{document}
\fancypagestyle{plain}{\pagestyle{fancy}}
\frontmatter 
% cabe?lho para as p?inas das se?es anteriores ao cap?ulo 1 (frontmatter)
\fancyhead[RO]{{\footnotesize\rightmark}\hspace{2em}\thepage}
\setcounter{tocdepth}{2}
\fancyhead[LE]{\thepage\hspace{2em}\footnotesize{\leftmark}}
\fancyhead[RE,LO]{}
\fancyhead[RO]{{\footnotesize\rightmark}\hspace{2em}\thepage}

\onehalfspacing  % espa?mento

% ---------------------------------------------------------------------------- %
% CAPA
% Nota: O t?ulo para as disserta?es/teses do IME-USP devem caber em um 
% orif?io de 10,7cm de largura x 6,0cm de altura que h?na capa fornecida pela SPG.
\thispagestyle{empty}
\begin{center}
    \large{\textbf{Instituto de Pesquisas Tecnológicas do Estado de São Paulo}}\\
    
    \vspace*{4cm}
    
    
    
    
    \large{\textbf{Marcelo de Rezende Martins}}
    
    \vspace*{6cm}
    
    \textbf{\large{Uso de redes neurais convolucionais na recuperação de trecho de código-fonte}}\\
    
    
    
   \vspace*{10cm}
   
    \large{\textbf{São Paulo}} \\
    \large{\textbf{2020}}
\end{center}

% ---------------------------------------------------------------------------- %
% P?ina de rosto (S?PARA A VERS? DEPOSITADA - ANTES DA DEFESA)
% Resolu?o CoPGr 5890 (20/12/2010)
%
% IMPORTANTE:
%   Coloque um '%' em todas as linhas
%   desta p?ina antes de compilar a vers?
%   final, corrigida, do trabalho
%
%
\newpage
\thispagestyle{empty}
    \begin{center}
        Marcelo de Rezende Martins\\
        \vspace*{2.3 cm}
        Uso de redes neurais convolucionais na recuperação de trecho de código-fonte\\
        \vspace*{2 cm}
    \end{center}

    \vskip 2cm

    \hspace{6cm}\begin{minipage}{0.48\linewidth}
	Dissertação de Mestrado apresentada
	ao Instituto de Pesquisas Tecnológicas do\\
	Estado de São Paulo - IPT, como 
	parte dos requisitos para a obtenção do 
	título de Mestre em Engenharia de 
	Computação
    \end{minipage}
    
    \vskip 2cm
    
    \hspace{6cm}\begin{minipage}{0.48\linewidth}
	Data da aprovação \rule{0.7cm}{0.4pt}/\rule{0.7cm}{0.4pt}/\rule{1.4cm}{0.4pt}
    \end{minipage}
    
    \vskip 2cm
    
    \hspace{6cm}\begin{minipage}{0.48\linewidth}
	\rule{7cm}{0.4pt}\\
	Prof. Dr. Marco Aurélio Gerosa\\
	Mestrado Engenharia de Computação\\
    \end{minipage}
\\
\\
Membros da Banca Examinadora:\\ 
\\
Prof. Dr. Marco Aurélio Gerosa (Orientador)\\
Mestrado Engenharia de Computação\\
\\
Prof. Dr. Marcelo Finger (Membro)\\
Instituto de Matemática e Estatística da Universidade de São Paulo (IME-USP)\\
\\
Prof. Dr. Marcelo Novaes de Rezende (Membro)\\
Mestrado Engenharia de Computação\\


\pagebreak


% ---------------------------------------------------------------------------- %
% P?ina de rosto (S?PARA A VERS? CORRIGIDA - AP? DEFESA)
% Resolu?o CoPGr 5890 (20/12/2010)
%
% Nota: O t?ulo para as disserta?es/teses do IME-USP devem caber em um 
% orif?io de 10,7cm de largura x 6,0cm de altura que h?na capa fornecida pela SPG.
%
% IMPORTANTE:
%   Coloque um '%' em todas as linhas desta
%   p?ina antes de compilar a vers? do trabalho que ser?entregue
%   ?Comiss? Julgadora antes da defesa
%
%
\newpage
\thispagestyle{empty}
    \begin{center}
        Marcelo de Rezende Martins\\
        \vspace*{2.3 cm}
        Uso de redes neurais convolucionais na recuperação de trecho de código-fonte\\
        \vspace*{2 cm}
    \end{center}

    \vskip 2cm

    \hspace{6cm}\begin{minipage}{0.48\linewidth}
	Dissertação de Mestrado apresentada
	ao Instituto de Pesquisas Tecnológicas do\\
	Estado de São Paulo - IPT, como 
	parte dos requisitos para a obtenção do 
	título de Mestre em Engenharia de 
	Computação
    \end{minipage}
    
    \vskip 2cm
    
    \hspace{6cm}\begin{minipage}{0.48\linewidth}
	Área de Concentração: Engenharia de Software
    \end{minipage}
    
    \vskip 2cm
    
    \hspace{6cm}\begin{minipage}{0.48\linewidth}
	Orientador: Prof. Dr. Marco Aurélio Gerosa
    \end{minipage}
    
    \vskip 6cm
    
    \begin{center}
        São Paulo\\
        
        Dezembro / 2020
    \end{center}

\pagebreak



\chapter*{\makebox[\linewidth]{DEDICATÓRIA}}
\thispagestyle{empty}
\begin{center}
    \textit{Dedico à Shyrlei e à Luzia.}
\end{center}

\pagenumbering{roman}     % come?mos a numerar 

% ---------------------------------------------------------------------------- %
% Agradecimentos:
% Se o candidato n? quer fazer agradecimentos, deve simplesmente eliminar esta p?ina 
\chapter*{\makebox[\linewidth]{AGRADECIMENTOS}}
\thispagestyle{empty}
Agradeço à minha família por todo apoio e compreensão ao longo do mestrado.
\\

Agradeço aos amigos e colegas de trabalho. Agradeço ao Lucas e Rodrigo Minami pela ajuda no início do curso quando estava um pouco perdido. Agradeço o apoio do Augusto, Juliano e Valmir.
\\

Agradeço a prontidão e presteza dos funcionários do IPT, Adilson, Bruno e Mary.
\\

Agradeço ao Professor Dr. Marco Aurélio Gerosa por ter aceitado me orientar e ter dado a liberdade de escolha do tema. 

\newpage
\thispagestyle{empty}

\begin{center}
        \vspace*{18 cm}
        \begin{quote}
            \textit{''Basta apenas uma boa lembrança para um homem continuar firme em sua caminhada.''}
        \end{quote}
        \begin{flushright}
        Fiódor Dostoiévski, \textit{Os Irmãos Karamázov}\\
        \end{flushright}
    \end{center}


\pagebreak
% ---------------------------------------------------------------------------- %
% Resumo
\chapter*{\makebox[\linewidth]{RESUMO}}
\thispagestyle{empty}

Os desenvolvedores realizam buscas por código-fonte diariamente através de buscadores de propósito geral (p. ex. Google). Entretanto, esses buscadores não são capazes de recuperar trechos de código-fonte semanticamente, a não ser que o código esteja acompanhado de um texto descritivo. O presente trabalho propõe uma nova abordagem de busca semântica de trechos de código-fonte através do uso de redes neurais convolucionais. As redes neurais convolucionais priorizam as interações locais (p. ex. palavras próximas) e são invariantes a translações (p. ex. deslocamento de um conjunto de palavras). Para verificar a eficácia da nossa proposta, comparamos o nosso modelo com dois outros métodos: um modelo de base de comparação e o atual estado da arte. Obtivemos, ao final, um resultado 5\% superior em relação ao atual estado da arte e 11\% superior ao método de comparação proposto. Além disso, o nosso modelo foi capaz de exibir o código-fonte correto nas 3 primeiras posições em 78\% das vezes e retornou na primeira posição em 60\% dos casos. Esses bons resultados permitem direcionar futuras pesquisas na recuperação de trecho de código-fonte para o uso e avaliação de técnicas que priorizem as interações locais.
\\

\noindent \textbf{Palavras-chave:} recuperação de trecho de código-fonte, busca de código-fonte, redes neurais, redes neurais convolucionais, cnn.

% ---------------------------------------------------------------------------- %
% Abstract
\chapter*{\makebox[\linewidth]{ABSTRACT}}
\thispagestyle{empty}
\begin{center}\textbf{A Convolutional Neural Network approach to code retrieval}
\\
\end{center}
Developers search daily for code using general-purpose search engines (e.g. Google). These search engines cannot find code semantically, unless it has an accompanying description. Our work proposes a new approach to look for code semantically by using a convolutional neural network. Convolutional Neural Network (CNN), which prioritizes local interactions (e.g. words nearby) and is translation invariant (e.g. shifting a set of words), showed promising results. To verify the efficacy of our approach, we compared our model with two other methods: baseline one and a state-of-the-art (SOTA). We improved SOTA by 5\% on average and the baseline by 11\%. Our model could retrieve the correct code snippet in the top 3 positions in 78\% of the time and at first position in 60\%. These promising results give a new direction in code retrieval by applying and evaluating local interactions techniques in future work.
\\

\noindent \textbf{Keywords:} code retrieval, code search, neural network, convolutional neural network, cnn.

\glstocfalse
% ---------------------------------------------------------------------------- %
% Sum?io
\renewcommand\contentsname{\makebox[\linewidth]{SUMÁRIO}}
\emptypage\tableofcontents   % imprime o sum?io

% ---------------------------------------------------------------------------- %

% ---------------------------------------------------------------------------- %
% \chapter{Lista de Símbolos}
% \begin{tabular}{ll}
%         $\omega$    & Frequência angular\\
%         $\psi$      & Função de análise \emph{wavelet}\\
%         $\Psi$      & Transformada de Fourier de $\psi$\\
% \end{tabular}

% \clearpage
%\glsaddall

\clearpage




% ---------------------------------------------------------------------------- %
% Listas de figuras e tabelas criadas automaticamente
\renewcommand{\listfigurename}{\makebox[\linewidth]{Lista de ilustrações}}
\renewcommand{\listtablename}{\makebox[\linewidth]{Lista de tabelas}}
\emptypage\listoffigures
\emptypage\listoftables
\cleardoublepage
  \begingroup
  \let\ps@plain\ps@empty
  \pagestyle{empty}
  \printnoidxglossary[type=acronym,sort=word,nonumberlist,title={\makebox[\linewidth]{Lista de abreviaturas e siglas}}]
  \cleardoublepage
  \endgroup


% ---------------------------------------------------------------------------- %
% Cap?ulos do trabalho
\mainmatter

% cabe?lho para as p?inas de todos os cap?ulos
%\fancyhead[RE,LO]{\thesection}

\doublespacing              % espa?mento duplo - IPT
%\onehalfspacing            % espa?mento um e meio

\input cap-introducao        % associado ao arquivo: 'cap-introducao.tex'
\input cap-trabalhos-relacionados        % associado ao arquivo: 'cap-trabalhos-relacionados.tex'
\input cap-problema        % associado ao arquivo: 'cap-problema.tex'
\input cap-experimento      % associado ao arquivo: 'cap-experimento.tex'
\input cap-resultados        % associado ao arquivo: 'cap-resultados.tex'
\input cap-conclusoes        % associado ao arquivo: 'cap-conclusos.tex'
% \input cap-conclusoes        % associado ao arquivo: 'cap-conclusoes.tex'

% Bibliografia
\clearpage
\renewcommand\@biblabel[1]{}
\renewcommand\bibname{REFERÊNCIAS}
 \doublespacing   % espa?mento duplo
 
 
\fancyhf{}

\fancyhead[LE]{}
\fancyhead[RO]{\thepage}
%\bibliographystyle{abnt} % cita?o bibliogr?ica textual
\bibliography{bibliografia}  % associado ao arquivo: 'bibliografia.bib'

% cabe?lho para os ap?dices
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{\appendixname\ \thechapter}} {} }
\fancyhead[RE,LO]{}
\appendix
\include{ape-ajustes-hiper-parametros}
\include{ape-codigo-fonte}
%\include{ape-conjuntos}      % associado ao arquivo: 'ape-conjuntos.tex'

% ---------------------------------------------------------------------------- %


% ---------------------------------------------------------------------------- %
% ?dice remissivo
% \index{TBP|see{periodicidade região codificante}}
% \index{DSP|see{processamento digital de sinais}}
% \index{STFT|see{transformada de Fourier de tempo reduzido}}
% \index{DFT|see{transformada discreta de Fourier}}
% \index{Fourier!transformada|see{transformada de Fourier}}

% \printindex   % imprime o ?dice remissivo no documento 
\printnoidxglossary[sort=word]

\end{document}
